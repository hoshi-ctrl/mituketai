<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <title>位置情報共有</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 600px;
            margin: 0 auto;
            padding: 20px;
            text-align: center;
        }
        button {
            font-size: 16px;
            padding: 10px 20px;
            margin: 10px;
        }
        textarea {
            width: 100%;
            height: 100px;
            margin-bottom: 10px;
        }
        input {
            width: 100%;
            margin-bottom: 10px;
            padding: 5px;
        }
    </style>
</head>
<body>
    <h1>位置情報共有</h1>

    <div id="getLocationSection">
        <h2>自分の位置情報</h2>
        <button onclick="getLocation()">現在地を取得</button>
        <textarea id="locationDisplay" readonly placeholder="位置情報が表示されます"></textarea>
        <button onclick="copyLocation()">位置情報をコピー</button>
    </div>

    <div id="openMapSection">
        <h2>位置情報を開く</h2>
        <input type="text" id="pasteLocation" placeholder="位置情報を貼り付け">
        <button onclick="openMapFromInput()">Googleマップで開く</button>
    </div>

    <script>
        function getLocation() {
            if ("geolocation" in navigator) {
                navigator.geolocation.getCurrentPosition(
                    function(position) {
                        const latitude = position.coords.latitude;
                        const longitude = position.coords.longitude;
                        
                        // 位置情報を整形して表示
                        const locationText = `緯度: ${latitude}, 経度: ${longitude}
Google Maps URL: https://www.google.com/maps?q=${latitude},${longitude}`;
                        
                        document.getElementById('locationDisplay').value = locationText;
                    },
                    function(error) {
                        switch(error.code) {
                            case error.PERMISSION_DENIED:
                                alert("位置情報の利用が許可されていません");
                                break;
                            case error.POSITION_UNAVAILABLE:
                                alert("位置情報を取得できません");
                                break;
                            case error.TIMEOUT:
                                alert("位置情報の取得がタイムアウトしました");
                                break;
                            default:
                                alert("不明なエラーが発生しました");
                        }
                    }
                );
            } else {
                alert("このブラウザは位置情報に対応していません");
            }
        }

        function copyLocation() {
            const locationDisplay = document.getElementById('locationDisplay');
            locationDisplay.select();
            document.execCommand('copy');
            alert('位置情報をコピーしました');
        }

        function openMapFromInput() {
            const pastedLocation = document.getElementById('pasteLocation').value;
            
            // 緯度と経度を抽出する正規表現
            const latMatch = pastedLocation.match(/緯度:\s*([-\d.]+)/);
            const lngMatch = pastedLocation.match(/経度:\s*([-\d.]+)/);

            if (latMatch && lngMatch) {
                const latitude = latMatch[1];
                const longitude = lngMatch[1];
                
                // Googleマップを新しいタブで開く
                const googleMapsUrl = `https://www.google.com/maps?q=${latitude},${longitude}`;
                window.open(googleMapsUrl, '_blank');
            } else {
                // URLを直接チェック
                const urlMatch = pastedLocation.match(/https:\/\/www\.google\.com\/maps\?q=([-\d.]+),([-\d.]+)/);
                
                if (urlMatch) {
                    window.open(pastedLocation, '_blank');
                } else {
                    alert('有効な位置情報形式ではありません');
                }
            }
        }
    </script>
</body>
</html>
